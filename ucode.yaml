# Microcode RAM data description
#
# Copyright (c) 2024 David Hunter
#
# This program is GPL licensed. See COPYING for the full license.

types:
  - name: e_uaddr
    desc: ucode address
    type: enum
    width: 7
    prefix: UA_
    # values will come from the rows list

  - name: e_ubm
    desc: branch mode
    type: enum
    width: 2
    prefix: UBM_
    values:
      - ADV                     # advance (default)
      - DA                      # direct address
      - AT                      # at table lookup

  - name: e_mcy
    desc: machine cycle
    type: enum
    width: 2
    prefix: UTX_
    values:
      - T1
      - T2
      - T3
      - T4

  - name: e_urs
    desc: register select
    type: enum
    width: 4
    prefix: URS_
    values:
      - A
      - V
      - B
      - C
      - D
      - E
      - H
      - L
      - SP
      - PC
      - IE

columns:
  - name: bm
    type: e_ubm
    desc: branch mode
  - name: nua
    type: e_uaddr
    desc: next address
  - name: idx
    width: 3
    desc: general-purpose data
  - name: irl
    width: 1
    desc: IR load
  - name: srs
    type: e_urs
    desc: source reg select
  - name: drs
    type: e_urs
    desc: dest reg select
  - name: pc_inc
    width: 1
    desc: increment PC
  - name: pc_ab
    width: 1
    desc: pc -> ab

rows:
  - addr: FETCH_IR1_T1
    pc_ab: 1
  - addr: FETCH_IR1_T2
  - addr: FETCH_IR1_T3
    # Clear ir[:8], fetch ir[7:0]
    idx: 0
    irl: 1
  - addr: FETCH_IR1_T4
    # Increment PC
    pc_inc: 1
    bm: AT

  - addr: OP48_FETCH_IR2_T1
    at: 0x48
    pc_ab: 1
  - addr: OP48_FETCH_IR2_T2
  - addr: OP48_FETCH_IR2_T3
    # Set ir[:8] = 1, fetch ir[7:0]
    idx: 1
    irl: 1
  - addr: OP48_FETCH_IR2_T4
    # Increment PC
    pc_inc: 1
    bm: AT

  - addr: DI
    at: 0x124
    pc_ab: 1
    bm: DA
    nua: FETCH_IR1_T2
    idx: 0
    drs: IE

  - addr: EI
    at: 0x120
    fcy: T1
    bm: DA
    nua: FETCH_IR1_T2
    idx: 1
    drs: IE
